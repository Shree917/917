-- Create Tables
CREATE TABLE studmarks (
    Name VARCHAR(50),
    TotalMarks INT
);

CREATE TABLE result (
    Roll_No TINYINT,
    Name VARCHAR(50),
    Class VARCHAR(25)
);

-- Change delimiter to create procedure
DELIMITER $

-- Stored Procedure to assign class based on marks
CREATE PROCEDURE proc_grade(
    IN rollno TINYINT,
    IN name VARCHAR(50),
    IN marks INT
)
BEGIN
    DECLARE class VARCHAR(25);

    IF marks >= 990 AND marks <= 1500 THEN
        SET class = 'Distinction';
    ELSEIF marks >= 900 AND marks <= 989 THEN
        SET class = 'First Class';
    ELSEIF marks >= 825 AND marks <= 899 THEN
        SET class = 'Second Class';
    ELSEIF marks >= 700 AND marks <= 824 THEN
        SET class = 'Pass';
    ELSE
        SET class = 'Fail';
    END IF;

    INSERT INTO studmarks(Name, TotalMarks) VALUES(name, marks);
    INSERT INTO result(Roll_No, Name, Class) VALUES(rollno, name, class);
END $
DELIMITER ;

-- Inserting Records using procedure
CALL proc_grade(1,'Aryan',850);
CALL proc_grade(2,'Peter',1000);
CALL proc_grade(3,'Smith',834);
CALL proc_grade(4,'Carol',750);
CALL proc_grade(5,'Bob',950);
CALL proc_grade(6,'Sam',650);

-- Check data
SELECT * FROM studmarks;
SELECT * FROM result;

-- Create Function to count students by class
DELIMITER $
CREATE FUNCTION tot_stud(classname VARCHAR(25))
RETURNS INT
BEGIN
    DECLARE total INT DEFAULT 0;

    SELECT COUNT(*) INTO total
    FROM result
    WHERE Class = classname;

    RETURN total;
END $
DELIMITER ;

-- Calling function
SELECT tot_stud('Second Class');
SELECT tot_stud('Pass');
SELECT tot_stud('Distinction');
SELECT tot_stud('Fail');
